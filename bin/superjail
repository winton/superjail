#!/usr/bin/env ruby

require 'rubygems'
require 'superjail'
include  Superjail

case ARGV.shift
when 'install'
  case ARGV.shift
  when 'jailkit'
    Jailkit.install
  end
when 'test'
  Jail.create('/jail',
    :sections => [{
      :name => :ruby,
      :paths => [ '/usr/local/lib/ruby' ],
      :executables => [ '/usr/local/bin/ruby', '/usr/local/bin/gem' ]
    }],
    :shell => {
     :group => 'free',
     :paths => [ '/usr/local/bin', '/usr/bin' ],
     :executables => [ '/usr/local/bin/ruby' ]
    }
  )
  Jail::User.create('/jail', 'free', 'user', 'password')
  Jail::User.execute_as_jailed_user('ls', '/jail', 'free', 'user', 'password')
end